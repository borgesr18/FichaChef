<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Debug Service Worker</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 10px;
            margin: 10px 0;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .online { background: #d4edda; color: #155724; }
        .offline { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ Teste Debug Service Worker - FichaChef</h1>
        
        <div id="status" class="status">Verificando status...</div>
        
        <div>
            <button onclick="triggerServiceWorkerChange()">ğŸ”„ Simular MudanÃ§a SW</button>
            <button onclick="clearLogs()">ğŸ—‘ï¸ Limpar Logs</button>
            <button onclick="checkOnlineStatus()">ğŸŒ Status Online</button>
        </div>
        
        <h3>ğŸ“‹ Logs do Sistema:</h3>
        <div id="logs" class="log">Aguardando eventos...
</div>
        
        <h3>â„¹ï¸ InformaÃ§Ãµes:</h3>
        <p>Este teste simula as condiÃ§Ãµes que causam o reload automÃ¡tico no FichaChef.</p>
        <p>Quando vocÃª clicar em "Simular MudanÃ§a SW", verÃ¡ os logs detalhados antes do reload ser executado.</p>
        <p><strong>ModificaÃ§Ãµes implementadas:</strong></p>
        <ul>
            <li>âœ… Logs detalhados com timestamp e stack trace</li>
            <li>âœ… Delay de 3 segundos antes do reload</li>
            <li>âœ… RemoÃ§Ã£o de hooks React desnecessÃ¡rios</li>
        </ul>
    </div>

    <script>
        // Simular o logger do sistema
        const logger = {
            info: (msg) => addLog('â„¹ï¸ INFO: ' + msg),
            warn: (msg) => addLog('âš ï¸ WARN: ' + msg),
            error: (msg) => addLog('âŒ ERROR: ' + msg)
        };

        function addLog(message) {
            const logs = document.getElementById('logs');
            const timestamp = new Date().toLocaleTimeString();
            logs.textContent += `[${timestamp}] ${message}\n`;
            logs.scrollTop = logs.scrollHeight;
        }

        function clearLogs() {
            document.getElementById('logs').textContent = 'Logs limpos...\n';
        }

        function checkOnlineStatus() {
            const isOnline = navigator.onLine;
            const status = document.getElementById('status');
            if (isOnline) {
                status.className = 'status online';
                status.textContent = 'ğŸŸ¢ Sistema Online';
                addLog('Sistema estÃ¡ online');
            } else {
                status.className = 'status offline';
                status.textContent = 'ğŸ”´ Sistema Offline';
                addLog('Sistema estÃ¡ offline');
            }
        }

        function triggerServiceWorkerChange() {
            addLog('ğŸ”„ SIMULANDO MUDANÃ‡A DO SERVICE WORKER...');
            
            // Simular o comportamento do service-worker-utils.ts modificado
            console.warn('ğŸ”„ SERVICE WORKER CONTROLLER CHANGE DETECTED!');
            console.warn('ğŸ“ Origem: service-worker-utils.ts linha 272');
            console.warn('â° Timestamp:', new Date().toISOString());
            console.warn('ğŸ” Stack trace:', new Error().stack);
            
            addLog('ğŸ”„ SERVICE WORKER CONTROLLER CHANGE DETECTED!');
            addLog('ğŸ“ Origem: service-worker-utils.ts linha 272');
            addLog('â° Timestamp: ' + new Date().toISOString());
            addLog('ğŸ” Stack trace disponÃ­vel no console do navegador');
            
            logger.info('Service Worker controller changed, reloading in 3 seconds...');
            
            let countdown = 3;
            const countdownInterval = setInterval(() => {
                addLog(`â±ï¸ Reload em ${countdown} segundos...`);
                countdown--;
                
                if (countdown < 0) {
                    clearInterval(countdownInterval);
                    console.warn('ğŸš€ EXECUTANDO RELOAD AGORA!');
                    addLog('ğŸš€ EXECUTANDO RELOAD AGORA!');
                    
                    // Em um ambiente real, seria window.location.reload()
                    // Aqui apenas simulamos
                    addLog('âœ… RELOAD SIMULADO - Em produÃ§Ã£o a pÃ¡gina seria recarregada');
                }
            }, 1000);
        }

        // Verificar status inicial
        checkOnlineStatus();
        
        // Monitorar mudanÃ§as de status online/offline
        window.addEventListener('online', () => {
            addLog('ğŸŸ¢ ConexÃ£o restaurada');
            checkOnlineStatus();
        });
        
        window.addEventListener('offline', () => {
            addLog('ğŸ”´ ConexÃ£o perdida');
            checkOnlineStatus();
        });
        
        addLog('ğŸš€ Sistema de debug inicializado');
        addLog('ğŸ“± Teste as funcionalidades usando os botÃµes acima');
    </script>
</body>
</html>